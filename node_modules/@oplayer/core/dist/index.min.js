/**
 * name: @oplayer/core
 * version: v1.2.31
 * description: Oh! Another HTML5 video player.
 * author: shiyiya
 * homepage: https://github.com/shiyiya/oplayer
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).OPlayer=t()}(this,(function(){var e,t,i,s,n,r,o,l,a;const u=["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","encrypted","waitingforkey","enterpictureinpicture","leavepictureinpicture"],c=["contextmenu"],h=["loadedplugin","videoqualitychange","videosourcechange","destroy"],d=[].concat(u,c,h);class p{constructor(){this.events=Object.create(null)}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}onAny(e,t){e.forEach((e=>this.on(e,t)))}once(e,t){const i=i=>{t({type:e,payload:i.payload})};i.raw=t,this.on(e,i)}off(e,t){if(this.events[e])for(let i=0;i<this.events[e].length;i++){const s=this.events[e][i];s!=t&&t!=s.raw||this.events[e].splice(i,1)}}offAny(e){this.events[e]=[]}offAll(){this.events=Object.create(null)}emit(e,t){var i,s;const n=[];null==(i=this.events[e])||i.forEach((i=>{i({type:e,payload:t}),i.raw&&n.push(i)})),null==(s=this.events["*"])||s.forEach((i=>{i({type:e,payload:t}),i.raw&&n.push(i)})),n.forEach((t=>{this.off(e,t)}))}}function g(e){return Boolean(e&&"object"==typeof e&&!Array.isArray(e))}function f(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];if(!i.length)return e;const n=i.shift();if(g(e)&&g(n))for(const r in n)g(n[r])?(e[r]||Object.assign(e,{[r]:{}}),f(e[r],n[r])):Object.assign(e,{[r]:n[r]});return f.apply(void 0,[e].concat(i))}const v=Object.freeze(Object.defineProperty({__proto__:null,isObject:g,isPlainObject:function(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},mergeDeep:f},Symbol.toStringTag,{value:"Module"})),m={Play:"播放",Pause:"暂停",Loop:"循环播放",Volume:"音量","Volume: %s":"音量：%s",Mute:"静音",Speed:"播放速度",LIVE:"直播",Language:"语言",Screenshot:"截图",Subtitle:"字幕",Quality:"画质",Fullscreen:"全屏","TextDecoder Not Supported":"不支持原生字幕",Settings:"设置","Picture in Picture":"画中画",Danmaku:"弹幕",Display:"显示",Opacity:"透明度",FontSize:"字体大小","Display Area":"显示区域",Off:"关闭",Auto:"自动",Default:"默认",Normal:"正常","%ss":"%s秒",Close:"关闭","Can be closed after %ss":"%s秒后可关闭广告"};class y{constructor(e){this.languages={zh:m,"zh-CN":m,en:Object.keys(m).reduce(((e,t)=>(e[t]=t,e)),{})},this.lang="auto"===e?navigator.language:e,this.languages[this.lang]||navigator.languages.some((e=>{if(this.languages[e])return this.lang=e,!0;if(-1!==e.indexOf("-")){const t=e.split("-")[0];if(t&&this.languages[t])return this.lang=t,!0}return!1})),this.languages[this.lang]||(this.lang="zh-CN")}get(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];const n=this.languages[this.lang][e];if(null==n)return e;let r=0;return n.replace(/%s/gi,(()=>{var e;return null!==(e=i[r++])&&void 0!==e?e:""}))}update(e){f(this.languages,e)}}function b(e){return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=1540483477,s=24,n=t^e.length,r=e.length,o=0;for(;r>=4;){let t=E(e,o);t=P(t,i),t^=t>>>s,t=P(t,i),n=P(n,i),n^=t,o+=4,r-=4}switch(r){case 3:n^=w(e,o),n^=e.charCodeAt(o+2)<<16,n=P(n,i);break;case 2:n^=w(e,o),n=P(n,i);break;case 1:n^=e.charCodeAt(o),n=P(n,i)}return n^=n>>>13,n=P(n,i),n^=n>>>15,n>>>0}(e).toString(36)}function E(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)+(e.charCodeAt(t++)<<16)+(e.charCodeAt(t)<<24)}function w(e,t){return e.charCodeAt(t++)+(e.charCodeAt(t++)<<8)}function P(e,t){return(65535&(e|=0))*(t|=0)+(((e>>>16)*t&65535)<<16)|0}var O,S=/[(),]|"(?:\\.|[^"\n])*"|'(?:\\.|[^'\n])*'|\/\*[\s\S]*?\*\//g;function k(e){if(-1===e.indexOf(","))return[e];for(var t,i=[],s=[],n=0;t=S.exec(e);)switch(t[0]){case"(":n++;break;case")":n--;break;case",":if(n)break;i.push(t.index)}for(t=i.length;t--;)s.unshift(e.slice(i[t]+1)),e=e.slice(0,i[t]);return s.unshift(e),s}function $(e,t){let i=k(e);return k(t).map((e=>e.indexOf("&")>=0?e:"&"+e)).reduce(((e,t)=>e.concat(i.map((e=>t.replace(/\&/g,e))))),[]).join(",")}function x(e){return 0===e.indexOf("@media")}function T(e){return 0===e.indexOf("@keyframes")}function j(e,t){var i;let s=t.rules,n=t.mediaQuery,r=t.globalSelector,o={};return r&&(e=r),null==(i=Object.keys(s))||i.forEach((t=>{if(function(e){return 0===e.indexOf("@global")}(t)){const i=t,l=(t=t.substring(8)).indexOf("&");let a;-1!=l?(a=$(e,t),r=t.substring(0,l-1).trim()):a=t,f(o,j(a,{mediaQuery:n,rules:s[i],globalSelector:a}))}else if(function(e){let t=[":",".","[",">"," "],i=!1,s=e.charAt(0);for(let n=0;n<t.length;n++)if(s===t[n]){i=!0;break}return i||e.indexOf("&")>=0}(t))f(o,j($(e,t),{rules:s[t],mediaQuery:n}));else if(x(t))f(o,j(e,{mediaQuery:(d=n,p=t,d?"@media "+d.substring(6)+" and "+p.substring(6):p),rules:s[t]}));else{var i,l,a,u,c,h;if(n)null!==(i=o[n])&&void 0!==i||(o[n]={}),null!==(u=(l=o[n])[a=e])&&void 0!==u||(l[a]={}),o[n][e][t]=s[t];else if(T(t))o[t]=s[t];else null!==(h=o[c=e])&&void 0!==h||(o[c]={}),o[e][t]=s[t]}var d,p})),o}function A(e){let t=[];for(const i in e)if(Object.hasOwnProperty.call(e,i)){const s=e[i];g(s)?t.push(i+"{"+A(s)+"}"):t.push(i+":"+s)}return/^\d%/.test(t[0])?t.join(" "):t.join(";")}function F(e){let t=[];for(const i in e)if(Object.hasOwnProperty.call(e,i)){const s=e[i];if(x(i))t.push(i+"{"+F(s)+"}");else if(T(i))t.push(i+"{"+A(s)+"}");else{const e=Object.entries(s).map((e=>e[0]+":"+e[1])).join(";");t.push(i+"{"+e+"}")}}return t}function C(e,t){return F(j(t,{rules:e}))}(e=>{function t(t){if(!(0,e.isBrowser)())return null;let i=document.createElement("style");i.setAttribute("data-"+t,""),i.appendChild(document.createTextNode("")),(document.head||document.getElementsByTagName("head")[0]).appendChild(i);for(let e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===i)return document.styleSheets.item(e);return null}e.create=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const s=-1!==e.indexOf("#"),n=-1!==e.indexOf("."),r=s?e.split("#"):n?e.split("."):[e],o=r[0],l=r[1],a=document.createElement(o);return s&&(a.id=l),n&&a.classList.add(l),i&&(a.innerHTML=i),Object.keys(t).forEach((e=>{const i=t[e];"video"!==o&&"audio"!==o||"boolean"!=typeof i?void 0!==i&&a.setAttribute(e,""+i):i&&a.setAttribute(e,"")})),a},e.render=(e,t)=>t.appendChild(e),e.isBrowser=()=>Boolean("undefined"!=typeof globalThis&&globalThis.document&&globalThis.document.documentElement),e.createSheet=t;const i=(()=>{const e=Object.create({});return t=>{const i="object"==typeof t?JSON.stringify(t):t;return e[i]||(e[i]="css-"+b(i)),e[i]}})();e.createCss=e=>{let t=e.sheet,s=e.ssrData;return function(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const l=Boolean(r[0]&&r[0].length&&r[0].raw);let a="";if(l){let e=r[0];a+=e[0];for(let t=1;t<r.length;t++)a+="string"!=typeof r[t]?"":r[t],a+=e[t]}else a="string"==typeof r[0]?r[0]:JSON.stringify(r[0]);const u=i(a);if(t)for(let i=0;i<t.cssRules.length;i++)if((null==(e=t.cssRules[i])?void 0:e.selectorText)=="."+u)return u;let c=["."+u+"{"+a+"}"];return l||"object"!=typeof r[0]||(c=C(r[0],"."+u)),t?c.forEach((e=>{t.insertRule(e,t.cssRules.length)})):s=s.concat(c),u}},e.createStyled=()=>{const i=[],s=t("oplayer");return{css:(0,e.createCss)({sheet:s,ssrData:i}),getCssValue:()=>i}};var s=(0,e.createStyled)();e.css=s.css,e.getCssValue=s.getCssValue,e.cls=e=>"css-"+b(e)})(O||(O={}));const _=O,L=/(iPad)/gi.test(null==(e=globalThis.navigator)?void 0:e.userAgent)||/Macintosh/i.test(null==(t=globalThis.navigator)?void 0:t.userAgent)&&Boolean(null==(i=globalThis.navigator)?void 0:i.maxTouchPoints)&&(null==(s=globalThis.navigator)?void 0:s.maxTouchPoints)>=1,R=/iPhone/gi.test(null==(n=globalThis.navigator)?void 0:n.userAgent),N=/^((?!chrome|android).)*safari/i.test(null==(r=globalThis.navigator)?void 0:r.userAgent),q=R||L,z=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone/i.test(null==(o=globalThis.navigator)?void 0:o.userAgent)||q,D=/mqqbrowser/i.test(null==(l=globalThis.navigator)?void 0:l.userAgent)&&!/ qq/i.test(null==(a=globalThis.navigator)?void 0:a.userAgent),I=Object.freeze(Object.defineProperty({__proto__:null,isIOS:q,isMobile:z,isQQBrowser:D,isSafari:N,isiPad:L,isiPhone:R},Symbol.toStringTag,{value:"Module"})),M={autoplay:!1,muted:!1,loop:!1,volume:1,preload:"metadata",playbackRate:1,playsinline:!0,lang:"auto",source:{},videoAttr:{},isLive:!1,autopause:!0,isNativeUI:()=>D},B=class e{constructor(e,t){if(this.plugins=[],this.context={},this.listeners=Object.create(null),this.hasError=!1,this.isSourceChanging=!1,this.container="string"==typeof e?document.querySelector(e):e,!this.container)throw new Error(("string"==typeof e?e:"Element")+"does not exist");this.options=Object.assign({},M,"string"==typeof t?{source:{src:t}}:t),this.locales=new y(this.options.lang),this.eventEmitter=new p}static make(t,i){return new e(t,i)}use(e){return e.forEach((e=>{this.plugins.push(e)})),this}create(){return this.render(),this.initEvent(),this.plugins.forEach(this.applyPlugin.bind(this)),this.options.source.src&&this.load(this.options.source),e.players.push(this),this}initEvent(){this.listeners.error=e=>{this.$video.error&&(this.hasError=!0,this.eventEmitter.emit("error",e))},this.$video.addEventListener("error",(e=>this.listeners.error(e)));const e=(e,t)=>{this.eventEmitter.emit(e,t)};[[this.$video,["fullscreenchange","webkitbeginfullscreen","webkitendfullscreen"],["fullscreenerror","webkitfullscreenerror","mozfullscreenerror"]],[this.$root,["fullscreenchange","webkitfullscreenchange"],["fullscreenerror","webkitfullscreenerror","mozfullscreenerror"]]].forEach((t=>{const i=t[0];t.slice(1).forEach((t=>{const s=t[0];this.listeners[s]=e,t.forEach((e=>{i.addEventListener(e,(e=>{this.listeners[s](s,e)}),{passive:!0})}))}))})),[[this.$video,u],[this.$root,c]].forEach((t=>{let i=t[0];t[1].forEach((t=>{this.listeners[t]||(this.listeners[t]=e,i.addEventListener(t,(e=>{var i;null==(i=this.listeners)||i[t](t,e)}),{passive:!0}))}))}))}render(){this.$video=_.create("video."+_.css("\n        width: 100%;\n        height: 100%;\n        display: block;\n        position: relative;\n      "),Object.assign({autoplay:this.options.autoplay,loop:this.options.loop,playsinline:this.options.playsinline,"webkit-playsinline":this.options.playsinline,"x5-playsinline":this.options.playsinline,preload:this.options.preload,poster:this.options.source.poster},this.options.videoAttr));const e=this.options,t=e.muted,i=e.volume,s=e.playbackRate;t&&this.mute(),this.$video.volume=i,setTimeout((()=>{this.setPlaybackRate(s)})),this.$root=_.create("div."+_.css("\n        position: relative;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n        background-color: #000;\n      ")),_.render(this.$video,this.$root),_.render(this.$root,this.container)}async load(e){var t;await(null==(t=this.loader)?void 0:t.destroy()),this.loader=void 0;for(const i of this.plugins)if(i.load){const t=await i.load(this,e);if(0!=t&&!this.loader){this.loader=t,this.emit("loaderchange",t);break}}return this.loader||(this.$video.src=e.src),e}applyPlugin(e){const t=e.apply(this),i=e.name,s=e.key;t&&(this.context[s||i]=t)}on(e,t){return"string"==typeof e?this.eventEmitter.on(e,t):Array.isArray(e)?this.eventEmitter.onAny(e,t):"function"==typeof e&&this.eventEmitter.on("*",e),this}once(e,t){this.eventEmitter.once(e,t)}off(e,t){this.eventEmitter.off(e,t)}emit(e,t){this.eventEmitter.emit(e,t)}setPoster(e){this.$video.poster=e}play(){if(this.$video.src&&!this.isSourceChanging){if(this.options.autopause)for(let t=0;t<e.players.length;t++){const i=e.players[t];i!=this&&i.pause()}return this.$video.play()}}pause(){return this.$video.pause()}togglePlay(){return this.isPlaying?this.pause():this.play()}mute(){this.$video.muted=!0}unmute(){this.$video.muted=!1}toggleMute(){this.isMuted?this.unmute():this.mute()}setVolume(e){this.$video.volume=e>1?1:e<0?0:e,this.$video.volume>0&&this.isMuted&&this.unmute()}setPlaybackRate(e){this.$video.playbackRate=e}seek(e){this.$video.currentTime=e}setLoop(e){this.$video.loop=e}async enterFullscreen(){this.isInPip&&await this.exitPip(),this._requestFullscreen?this._requestFullscreen.call(this.$root,{navigationUI:"hide"}):this.$video.webkitEnterFullscreen()}exitFullscreen(){return this._exitFullscreen.call(document)}get isFullscreenEnabled(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||this.$video.webkitEnterFullscreen}get isFullScreen(){return Boolean((document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)===this.$root||this.$video.webkitDisplayingFullscreen)}toggleFullScreen(){return this.isFullScreen?this.exitFullscreen():this.enterFullscreen()}get isPipEnabled(){return document.pictureInPictureEnabled}enterPip(){return this.$video.requestPictureInPicture()}exitPip(){return!!this.isInPip&&document.exitPictureInPicture()}get isInPip(){return document.pictureInPictureElement==this.$video}togglePip(){return this.isInPip?this.exitPip():this.enterPip()}_resetStatus(){this.hasError=!1,this.isPlaying&&this.$video.pause()}changeQuality(e){return this.isSourceChanging=!0,this.emit("videoqualitychange",e),this._loader(e,{keepPlaying:!0,keepTime:!0,event:"videoqualitychanged"})}changeSource(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.isSourceChanging=!0,this.emit("videosourcechange",e),this._loader(e,{keepPlaying:t,event:"videosourcechanged"})}_loader(e,t){const i=this.isPlaying,s=this.currentTime,n=this.volume,r=this.playbackRate,o=t.keepPlaying,l=t.keepTime,a="none"==this.options.preload,u=a?"loadstart":"loadedmetadata",c=o&&i;let h;return this._resetStatus(),new Promise(((i,o)=>{const d=e=>{this.isSourceChanging=!1,this.off(u,p),o(e)},p=()=>{this.isSourceChanging=!1,this.off("error",d),this.emit(t.event,h),n!=this.volume&&this.setVolume(n),r!=this.playbackRate&&this.setPlaybackRate(r),a&&l&&this.$video.load(),l&&!this.options.isLive&&this.seek(s),c&&!this.isPlaying&&this.$video.play(),i()};return(e instanceof Promise?e:Promise.resolve(e)).then((e=>{if(!e.src)throw new Error("Empty Source");return h=e,this.$video.poster=e.poster||"",Object.assign(this.options.source,e),this.once("error",d),this.once(u,p),e})).then((e=>this.load(e))).catch(d)}))}destroy(){e.players.splice(e.players.indexOf(this),1);const t=this.eventEmitter,i=this.loader,s=this.plugins,n=this.container,r=this.$root,o=this.$video,l=this.isPlaying,a=this.isFullScreen,u=this.isInPip;t.emit("destroy"),t.offAll(),null==i||i.destroy(),s.forEach((e=>{var t;return!e.load&&(null==(t=e.destroy)?void 0:t.call(e))})),l&&this.pause(),a&&this.exitFullscreen(),u&&this.exitPip(),o.src&&URL.revokeObjectURL(o.src),n.removeChild(r),this.eventEmitter=this.locales=this.options=this.listeners=this.context=this.plugins=this.container=this.$root=this.$video=this.loader=void 0}get isNativeUI(){return this.options.isNativeUI()}get state(){return this.$video.readyState}get isPlaying(){return!this.$video.paused}get isMuted(){return this.$video.muted}get isEnded(){return this.$video.ended}get isLoop(){return this.$video.loop}get isAutoPlay(){return this.$video.autoplay}get duration(){return this.$video.duration}get buffered(){return this.$video.buffered}get currentTime(){return this.$video.currentTime}get volume(){return this.$video.volume}get playbackRate(){return this.$video.playbackRate}get _requestFullscreen(){return HTMLElement.prototype.requestFullscreen||HTMLElement.prototype.webkitRequestFullscreen||HTMLElement.prototype.mozRequestFullScreen||HTMLElement.prototype.msRequestFullscreen}get _exitFullscreen(){return Document.prototype.exitFullscreen||Document.prototype.webkitExitFullscreen||Document.prototype.cancelFullScreen||Document.prototype.mozCancelFullScreen||Document.prototype.msExitFullscreen}static get version(){return"1.2.31"}};B.players=[];let V=B;globalThis.window&&console.log("%cOPlayer%c v%s\n %c\nOh! Another HTML5 video player.\nhttps://github.com/shiyiya/oplayer\n","font-size:32px;","font-size:12px;color:#999999;",V.version,"font-size:14px;");const Q=(e,t,i)=>{var s;const n=document.createElement("script");n.src=e,n.onload=t,n.onerror=i;const r=document.getElementsByTagName("script")[0];null==(s=null==r?void 0:r.parentNode)||s.insertBefore(n,r)},H={},U=e=>void 0===e,J=Object.freeze(Object.defineProperty({__proto__:null,isUndefined:U,loadSDK:function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>!0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Q;const r=e=>U(window[e])?window.exports&&window.exports[e]?window.exports[e]:window.module&&window.module.exports&&window.module.exports[e]?window.module.exports[e]:void 0:window[e],o=r(t);return o&&s(o)?Promise.resolve(o):new Promise(((s,o)=>{if(!U(H[e]))return void H[e].push({resolve:s,reject:o});H[e]=[{resolve:s,reject:o}];const l=t=>{var i;null==(i=H[e])||i.forEach((e=>e.resolve(t)))};if(!U(i)){const e=window[i];window[i]=function(){U(e)||e.apply(void 0,arguments),l(r(t))}}n(e,(()=>{U(i)&&l(r(t))}),(t=>{var i;null==(i=H[e])||i.forEach((e=>{e.reject(t)})),delete H[e]}))}))},loadScript:Q},Symbol.toStringTag,{value:"Module"}));return Object.assign(V,{$:O,EVENTS:d,OH_EVENTS:h,VIDEO_EVENTS:u,PLAYER_EVENTS:c},v,I,J)}));
