/**
 * name: @oplayer/hls
 * version: v1.2.23
 * description: Hls plugin for oplayer
 * author: shiyiya
 * homepage: https://github.com/shiyiya/oplayer
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).OHls=e()}(this,(function(){"use strict";const t="oplayer-plugin-hls",e=(t,e,n)=>"hls"===e.format||"m3u8"===e.format||("auto"===e.format||void 0===e.format)&&/m3u8(#|\?|$)/i.test(e.src)&&(n||!(Boolean(t.canPlayType("application/x-mpegURL"))||Boolean(t.canPlayType("application/vnd.apple.mpegURL"))));class n{constructor(n){this.key="hls",this.name=t,this.version="1.2.23",this.options={config:{},forceHLS:!1,textControl:!0,audioControl:!0,qualityControl:!0,withBitrate:!1,qualitySwitch:"immediate",matcher:e},Object.assign(this.options,n)}apply(t){this.player=t}async load(e,a){var l,o;let s=e.$video;const r=this.options;if(!(0,r.matcher)(s,a,r.forceHLS))return!1;if(null!==(o=n.library)&&void 0!==o||(n.library=(await import("hls.js/dist/hls.min.js")).default),!n.library.isSupported())return!1;const u=this.options,c=u.config,h=u.active;this.instance=new n.library(c);const d=this.instance,g=this.player;return h&&h(d,n.library),d.loadSource(a.src),d.attachMedia(s),d.on(n.library.Events.ERROR,(function(e,n){const i=n.type,a=n.details;n.fatal&&(g.hasError=!0,g.emit("error",Object.assign({},n,{pluginName:t,message:i+": "+a})))})),(null==(l=g.context.ui)?void 0:l.setting)&&i(g,d,this.options),this}unload(){var t;null==(t=this.instance)||t.stopLoad()}destroy(){var t;if(this.instance){const e=this.player,i=this.instance,l=this.options.inactive;l&&l(i,n.library),(null==(t=e.context.ui)?void 0:t.setting)&&a(e),i.destroy()}}}n.library=globalThis.Hls;const i=function(e,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l=e.context.ui;function o(n){const i=n.settings();if(i&&i.length<2)return;const a=n.name,l=n.icon,o=n.onChange;e.context.ui.setting.unregister(t+"-"+a),e.context.ui.setting.register({name:e.locales.get(a),icon:l,onChange:o,type:"selector",key:t+"-"+a,children:i})}a.qualityControl&&(i.once(n.library.Events.MANIFEST_PARSED,(()=>{o({icon:l.icons.quality,name:"Quality",settings:()=>i.levels.length>1?i.levels.reduce(((t,e,n)=>{let l=(e.name||e.height).toString();if(isFinite(+l)&&(l+="p"),a.withBitrate){const t=e.bitrate/1e3,n=t>1e3;l+=" ("+(n?(t/1e3).toFixed(2):Math.floor(t))+(n?"m":"k")+"bps)"}return t.push({name:l,default:i.currentLevel==n,value:n}),t}),[{name:e.locales.get("Auto"),default:i.autoLevelEnabled,value:-1}]):[],onChange(t){"immediate"==a.qualitySwitch?(i.currentLevel=t.value,-1!==t.value&&(i.loadLevel=t.value)):(i.nextLevel=t.value,-1!==t.value&&(i.nextLoadLevel=t.value))}})})),i.on(n.library.Events.LEVEL_SWITCHED,(function(n,a){let o=a.level;if(i.autoLevelEnabled){const n=i.levels[o].height,a=e.locales.get("Auto")+(n?" ("+n+"p)":"");l.setting.updateLabel(t+"-Quality",a)}else l.setting.select(t+"-Quality",o+1,!1)}))),a.audioControl&&i.on(n.library.Events.AUDIO_TRACK_LOADED,(()=>{o({icon:l.icons.lang,name:"Language",settings:()=>i.audioTracks.length>1?i.audioTracks.map((t=>{let e=t.name,n=t.lang,a=t.id;return{name:n||e,default:i.audioTrack==a,value:a}})):[],onChange(t){i.audioTrack=t.value}})})),a.textControl&&i.on(n.library.Events.SUBTITLE_TRACK_LOADED,(()=>{o({icon:l.icons.subtitle,name:"Subtitle",settings:()=>i.subtitleTracks.length>1?i.subtitleTracks.reduce(((t,e)=>{let n=e.name,a=e.lang,l=e.id;return t.push({name:a||n,default:i.subtitleTrack==l,value:l}),t}),[{name:e.locales.get("Off"),default:!i.subtitleDisplay,value:-1}]):[],onChange(t){let e=t.value;(i.subtitleDisplay=!(-1==e))&&(i.subtitleTrack=e)}})}))},a=e=>{["Quality","Language","Subtitle"].forEach((n=>e.context.ui.setting.unregister(t+"-"+n)))};return function(t){return new n(t)}}));
